<!DOCTYPE html>
<html lang="en" class="bg-gradient-to-br from-purple-400 to-pink-500 dark:from-purple-900 dark:to-pink-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Anime Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; transition: background-color 0.5s, color 0.5s; }
        .chat-container { overflow-y: auto; scroll-behavior: smooth; }
        .chat-bubble { max-width: 80%; border-radius: 1.5rem; padding: 0.75rem 1.25rem; margin-bottom: 0.5rem; word-wrap: break-word; animation: fadeIn 0.3s ease-in-out; }
        .user-bubble { background-color: #f87171; color: white; align-self: flex-end; border-bottom-right-radius: 0.5rem; }
        .ai-bubble { background-color: #f3e8ff; color: #4c1d95; align-self: flex-start; border-bottom-left-radius: 0.5rem; }
        .loading-dots span { animation: bounce 1s infinite; }
        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-0.75rem); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-gray-800 dark:text-gray-200">

    <div id="app" class="min-h-screen flex flex-col items-center justify-center p-4">
        <header class="w-full max-w-4xl flex justify-center items-center py-4 mb-8 relative">
            <h1 class="text-4xl font-extrabold text-white animate-pulse">AI Anime Chat</h1>
            <button id="themeToggle" class="absolute right-0 top-1/2 -translate-y-1/2 p-2 rounded-full text-white bg-gray-800 dark:bg-gray-200 dark:text-gray-800 transition-colors duration-300">
                <i id="themeIcon" class="fas fa-moon"></i>
            </button>
        </header>

        <main id="content" class="w-full max-w-4xl p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 transition-colors duration-300 flex flex-col"></main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let loggedInUser = null;
            let customPrompt = '';
            const apiKey = "YOUR_GEMINI_API_KEY"; // replace with your real Gemini key
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const characters = [
                { id: 'gojo', name: 'Gojo Satoru', anime: 'Jujutsu Kaisen', imgUrl: 'https://i.ibb.co/GfCtcWJP/gojo-img.jpg' },
                { id: 'kafka', name: 'Kafka Hibino', anime: 'Kaiju No. 8', imgUrl: 'https://i.ibb.co/tT27T3HN/kaiju-no8-img.webp' },
                { id: 'luffy', name: 'Monkey D. Luffy', anime: 'One Piece', imgUrl: 'https://i.ibb.co/Ldng9kwy/luffy.jpg' },
                { id: 'zeno', name: 'Zeno', anime: 'Dragon Ball Super', imgUrl: 'https://i.ibb.co/fVzkrwGC/zeno.jpg' },
                { id: 'l', name: 'L', anime: 'Death Note', imgUrl: 'https://i.ibb.co/TM1F0690/l.jpg' },
                { id: 'jeremmy', name: 'Jeremy', anime: 'General AI', imgUrl: 'https://i.ibb.co/wZnn5JFS/jeremy.jpg' }
            ];

            const content = document.getElementById('content');

            function renderUserDashboard() {
                content.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${characters.map(char => `
                            <div class="bg-gradient-to-br from-teal-400 to-blue-500 p-6 rounded-xl shadow-lg cursor-pointer" data-char-id="${char.id}">
                                <img src="${char.imgUrl}" alt="${char.name}" class="w-24 h-24 mx-auto mb-4 rounded-full object-cover">
                                <h3 class="text-xl font-bold text-center text-white">${char.name}</h3>
                                <p class="text-sm text-gray-100 text-center mt-1">${char.anime}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
                content.querySelectorAll('[data-char-id]').forEach(el => {
                    el.addEventListener('click', e => {
                        const charId = e.currentTarget.dataset.charId;
                        const character = characters.find(c => c.id === charId);
                        renderChat(character);
                    });
                });
            }

            function renderChat(character) {
                const userChats = loggedInUser?.chats?.[character.id] || [];
                content.innerHTML = `
                    <div class="flex items-center justify-between mb-6">
                        <button id="backBtn" class="px-4 py-2 rounded-full bg-gray-200 dark:bg-gray-700">Back</button>
                        <div class="flex items-center space-x-4">
                            <img src="${character.imgUrl}" alt="${character.name}" class="w-12 h-12 rounded-full object-cover">
                            <h2 class="text-2xl font-bold">${character.name}</h2>
                        </div>
                    </div>
                    <div id="chat-messages" class="chat-container flex-grow flex flex-col space-y-4 mb-4 p-4 bg-white dark:bg-gray-800 rounded-xl shadow-inner border border-gray-200 dark:border-gray-700 min-h-[60vh]">
                        ${userChats.map(msg => `
                            <div class="${msg.role === 'user' ? 'self-end' : 'self-start'} flex items-start space-x-2 w-full">
                                <div class="chat-bubble ${msg.role === 'user' ? 'user-bubble' : 'ai-bubble dark:bg-purple-900 dark:text-purple-200'}">${msg.text}</div>
                            </div>
                        `).join('')}
                    </div>
                    <form id="chat-form" class="flex mt-4 space-x-2">
                        <input type="text" id="chat-input" placeholder="Say hi to ${character.name}..." class="flex-1 p-3 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100" required>

                        <!-- Voice button -->
                        <button type="button" id="voice-btn" class="px-4 py-3 rounded-full bg-pink-500 text-white hover:bg-pink-600 transition shadow-md">
                            <i class="fas fa-microphone"></i>
                        </button>

                        <button type="submit" id="send-btn" class="px-6 py-3 rounded-full font-semibold bg-purple-600 text-white hover:bg-purple-700">Send</button>
                    </form>
                `;

                const chatMessages = document.getElementById('chat-messages');
                const chatForm = document.getElementById('chat-form');
                const chatInput = document.getElementById('chat-input');

                document.getElementById('backBtn').addEventListener('click', renderUserDashboard);

                chatForm.addEventListener('submit', async e => {
                    e.preventDefault();
                    const userMessage = chatInput.value.trim();
                    if (!userMessage) return;

                    appendMessage('user', userMessage);
                    chatInput.value = '';

                    const loadingBubble = document.createElement('div');
                    loadingBubble.className = 'chat-bubble ai-bubble self-start loading-dots';
                    loadingBubble.innerHTML = '<span>.</span><span>.</span><span>.</span>';
                    chatMessages.appendChild(loadingBubble);
                    chatMessages.scrollTop = chatMessages.scrollHeight;

                    try {
                        const payload = {
                            contents: [{ parts: [{ text: userMessage }] }],
                            systemInstruction: { parts: [{ text: `You are ${character.name} from ${character.anime}.` }] },
                        };
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await response.json();
                        let aiMessage = result?.candidates?.[0]?.content?.parts?.[0]?.text || "I couldn't process that.";

                        loadingBubble.remove();
                        appendMessage('ai', aiMessage);
                        speakAI(aiMessage);
                    } catch (err) {
                        loadingBubble.remove();
                        appendMessage('ai', "Error: Could not connect to AI.");
                    }
                });

                // Voice Recognition
                const voiceBtn = document.getElementById('voice-btn');
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recognition = new SpeechRecognition();
                    recognition.lang = "en-US";
                    recognition.interimResults = false;

                    voiceBtn.addEventListener('click', () => {
                        recognition.start();
                        voiceBtn.classList.add("animate-pulse");
                    });

                    recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        chatInput.value = transcript;
                    };

                    recognition.onend = () => {
                        voiceBtn.classList.remove("animate-pulse");
                    };
                } else {
                    voiceBtn.disabled = true;
                    voiceBtn.title = "Voice not supported on this browser.";
                }

                function appendMessage(role, text) {
                    const msgDiv = document.createElement('div');
                    msgDiv.className = `${role === 'user' ? 'self-end' : 'self-start'} flex items-start space-x-2 w-full`;
                    msgDiv.innerHTML = `<div class="chat-bubble ${role === 'user' ? 'user-bubble' : 'ai-bubble dark:bg-purple-900 dark:text-purple-200'}">${text}</div>`;
                    chatMessages.appendChild(msgDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }

                // AI Voice Output
                function speakAI(text) {
                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.lang = "en-US";
                        speechSynthesis.speak(utterance);
                    }
                }
            }

            function renderApp() {
                loggedInUser = { username: 'guest', chats: {} };
                renderUserDashboard();
            }

            renderApp();
        });
    </script>
</body>
</html>
